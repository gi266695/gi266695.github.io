<!DOCTYPE html>
<html>
<head>
<script src="/Core/MainLoop.js"></script>
</head>
<body>
<div>
    <h2>Something Resembling a game</h2>
    <p id="FrameTime"></p>
    <input id="inputCheckBox_ShowHitBoxes" type="checkbox">Show Hitboxes</input>
    <input id="inputCheckBox_ShowSpriteBoxes" type="checkbox">Show SpriteBoxes</input>
    <input id="inputCheckBox_ShowSpriteCenters" type="checkbox">Show Sprite Centers</input>
</div>
<div id="sourceWindow" style= "background:black;">
</div>
<script> //Mainloop should be loaded becuase this comes after it

    var FirstTick = true;

    var sourceWindow = document.getElementById("sourceWindow");
    var FrameTime = document.getElementById("FrameTime");
    var inputCheckBox_ShowHitBoxes = document.getElementById("inputCheckBox_ShowHitBoxes"); 
    var inputCheckBox_ShowSpriteBoxes = document.getElementById("inputCheckBox_ShowSpriteBoxes"); 
    var inputCheckBox_ShowSpriteCenters = document.getElementById("inputCheckBox_ShowSpriteCenters");
    var gameplayLayer = null;

    var LastCoreData = null;

    var MinFrameRate = null;
    var MaxFrameRate = null;

    //Mainloop.js
    Core_Init(window, document, sourceWindow, "Core/", (coreData, DeltaTime) => {
        LastCoreData = coreData;

        if(FirstTick){
            FirstTick = false;
            lstGameScripts = ["/Game/GameObjects/GameObject.js"
                                , "/Game/GameObjects/SimpleBullet.js"
                                , "/Game/GameObjects/SimpleTurret.js"
                                , "/Game/GameObjects/PlayerObject.js"
                                , "/Game/Map/MapTiles.js"
                                , "/Game/Map/MapSprites.js"
                                , "/Game/Map/Level.js"
                                , "/Game/GameAssetLibrary.js"
                                , "/Game/GameplayLayer.js"];

            Core_LoadScripts(coreData, lstGameScripts, () => {
                coreData.AssetLibrary = new GameAssetLibrary();
                coreData.AssetLibrary.SetDependencies(coreData);
                coreData.AssetLibrary.LoadAssets(LstStr_GetGameObjectDependencies(), ()=> {
                    
                    gameplayLayer = new GameplayLayer();
                    coreData.LayerStack.AddLayer(gameplayLayer, 1);
                });
            });
            var DefaultChannel = coreData.AudioManager.Chanel_GetChannel(-1, true);
            DefaultChannel.Num_DefualtMinBeforeDropoff = 10;
            DefaultChannel.Num_DefualtDropOffRange = 10;
        }
        //enforce aspect ratio (16/9)
        var MaxHeight = window.innerHeight;

        var style = coreData.WindowObj.getComputedStyle(sourceWindow, null);
        var Num_Width = parseInt(style.width);
        var Num_Height = Num_Width * (9/16);
        if(Num_Height > MaxHeight){
            Num_Height = MaxHeight;        
        }

        sourceWindow.style.height = Num_Height + "px";

        //scale up/down screen based on size
        var Scale = 1;
        if(Num_Width != 0){
            Scale = Num_Width / 20;
        }
        coreData.LayerStack.GlobalTransform.SetToScale(Scale, Scale);

        //tick layer stack
        coreData.TickDraw(DeltaTime);

        if(MinFrameRate == null || MinFrameRate > DeltaTime){
            MinFrameRate = DeltaTime;
        }
        if(MaxFrameRate == null || MaxFrameRate < DeltaTime){
            MaxFrameRate = DeltaTime;
        }
        FrameTime.innerHTML = DeltaTime + "<br>Min: " + MinFrameRate + "<br>Max:" + MaxFrameRate + "<br>";
    });
    //show hitboxes
    if(inputCheckBox_ShowHitBoxes != null){
        inputCheckBox_ShowHitBoxes.onclick = () => {
            if(LastCoreData == null){
                return;
            }
            LastCoreData.DrawHitBoxes = inputCheckBox_ShowHitBoxes.checked;
        }
    }
    //show sprite boxes
    if(inputCheckBox_ShowSpriteBoxes != null){
        inputCheckBox_ShowSpriteBoxes.onclick = () => {
            if(LastCoreData == null){
                return;
            }
            LastCoreData.DrawSpriteBoxes = inputCheckBox_ShowSpriteBoxes.checked;
        }
    }
    //centers
    if(inputCheckBox_ShowSpriteCenters != null){
        inputCheckBox_ShowSpriteCenters.onclick = () => {
            if(LastCoreData == null){
                return;
            }
            LastCoreData.DrawSpriteCenters = inputCheckBox_ShowSpriteCenters.checked;
        }
    }

</script>
</body>
</html>